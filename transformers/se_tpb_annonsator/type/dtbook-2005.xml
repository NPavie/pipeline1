<?xml version="1.0" encoding="utf-8"?>
<ruleSet xmlns:dtb="http://www.daisy.org/z3986/2005/dtbook/">

	<prefix>annon</prefix>
	<namespace>http://www.example.com</namespace>
	<attributeBefore>before</attributeBefore>
	<attributeAfter>after</attributeAfter>
	<addAttributes>true</addAttributes>
	
	<!-- rules for announcements of authors -->
	<rule match="dtb:docauthor[1]">
		<lang lang="sv">
			<before>Av</before>
		</lang>
		<lang lang="en">
			<before>By</before>
		</lang>
	</rule>
	
	<rule match="dtb:docauthor[position()=last() and last()!=1]">
		<lang lang="sv">
			<before>och</before>
		</lang>
		<lang lang="en">
			<before>and</before>
		</lang>
	</rule>

	<!-- performed in speech generator
	<rule match="dtb:pagenum[@page='front']">
		<lang lang="sv">
			<before>Sidan (romerska siffror)</before>
		</lang>
		<lang lang="en">
			<before>Page (Roman Numeral)</before>
		</lang>
	</rule>
	-->
	
	<!-- performed in speech generator
	<rule match="dtb:pagenum[@page='normal']">
		<lang lang="sv">
			<before>Sidan</before>
		</lang>
		<lang lang="en">
			<before>Page</before>
		</lang>
	</rule>
	-->

	<!-- performed in speech generator	
	<rule match="dtb:noteref">
		<lang lang="sv">
			<before>Notreferens.</before>
		</lang>
		<lang lang="en">
			<before>Note reference.</before>
		</lang>
	</rule>
	-->
	
	<rule match="dtb:note">
		<lang lang="sv">
			<before>Not.</before>
			<after>Slut på noten.</after>
		</lang>
		<lang lang="en">
			<before>Note.</before>
			<after>End of note.</after>
		</lang>
	</rule>
	
	<rule match="dtb:prodnote">
		<lang lang="sv">
			<before>Kommentar.</before>
			<after>Slut kommentar.</after>
		</lang>
		<lang lang="en">
			<before>Production note.</before>
			<after>End of production note.</after>
		</lang>
	</rule>

	<rule match="dtb:imggroup/dtb:prodnote">
		<lang lang="sv">
			<before>Bildbeskrivning.</before>
			<after>Slut bildbeskrivning.</after>
		</lang>
		<lang lang="en">
			<before>Image description.</before>
			<after>End of image description.</after>
		</lang>
	</rule>
	
	<rule match="dtb:imggroup/dtb:caption">
		<lang lang="sv">
			<before>Bildtext.</before>
			<after>Slut bildtext.</after>
		</lang>
		<lang lang="en">
			<before>Caption.</before>
			<after>End of caption.</after>
		</lang>
	</rule>

	<rule match="dtb:sidebar">
		<lang lang="sv">
			<before>Parallell text.</before>
			<after>Slut parallell text.</after>
		</lang>
		<lang lang="en">
			<before>Side bar.</before>
			<after>End of side bar.</after>
		</lang>
	</rule>

	<rule match="dtb:poem">
		<lang lang="sv">
			<before>En dikt följer.</before>
			<after>Slut på dikten.</after>
		</lang>
		<lang lang="en">
			<before>A poem follows.</before>
			<after>End of poem.</after>
		</lang>
	</rule>

	<rule match="dtb:blockquote">
		<lang lang="sv">
			<before>Citat:</before>
			<after>Slut citat.</after>
		</lang>
		<lang lang="en">
			<before>Quote:</before>
			<after>End of quote.</after>
		</lang>
	</rule>

	
	<rule match="dtb:table">
		<lang lang="sv">
			<before>Tabell.</before>
			<after>Slut tabell.</after>
		</lang>
		<lang lang="en">
			<before>Table.</before>
			<after>End of table.</after>
		</lang>
	</rule>

	<rule match="dtb:code">
		<lang lang="sv">
			<before>Kod.</before>
			<after>Slut kod.</after>
		</lang>
		<lang lang="en">
			<before>Code.</before>
			<after>End of code.</after>
		</lang>
	</rule>

	<rule match="dtb:kbd">
		<lang lang="sv">
			<before>Tangentbordsinstruktion.</before>
		</lang>
		<lang lang="en">
			<before>Keyborad instruction.</before>
		</lang>
	</rule>

	<rule match="*[starts-with(@xml:lang,'mi') and ancestor::*/@xml:lang='en']">
		<lang lang="mi">
			<before>Maori text.</before>
		</lang>
	</rule>

	<rule match="*[starts-with(@xml:lang,'mi') and ancestor::*/@xml:lang='sv']">
		<lang lang="mi">
			<before>Maorisk text.</before>
		</lang>
	</rule>

	<copy attributes="true" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
		<xsl:template match="dtb:li">
			<xsl:copy>
				<xsl:if test="parent::dtb:list/@type='ol'">				
					<xsl:attribute name="{$prefix}:{$attrib_before}" namespace="{$ns}">
						<xsl:if test="parent::dtb:list[@enum='i' or @enum='I']">
							<xsl:choose>
								<xsl:when test="lang('en')">
									<xsl:text>Roman numeral, </xsl:text>
								</xsl:when>
								<xsl:when test="lang('sv')">
									<xsl:text>Romersk siffra, </xsl:text>
								</xsl:when>
							</xsl:choose>
						</xsl:if>
						<xsl:variable name="start">
							<xsl:choose>
								<xsl:when test="parent::dtb:list/@start">
									<xsl:value-of select="parent::dtb:list/@start"/>
								</xsl:when>
								<xsl:otherwise>1</xsl:otherwise>
							</xsl:choose>
						</xsl:variable>
						<xsl:choose>
							<xsl:when test="parent::dtb:list[@enum='a' or @enum='A']">
								<xsl:value-of select="codepoints-to-string(string-to-codepoints('A') - 1 + count(preceding-sibling::dtb:li) + round($start))"/>
							</xsl:when>
							<xsl:otherwise>
								<xsl:value-of select="count(preceding-sibling::dtb:li) + round($start)"/>
							</xsl:otherwise>
						</xsl:choose>
						<xsl:text>. </xsl:text>
					</xsl:attribute>
				</xsl:if>
				<xsl:copy-of select="@*"/>
				<xsl:apply-templates/>
			</xsl:copy>
		</xsl:template>
	</copy>

</ruleSet>
